#!/usr/bin/env ruby

# De-reference if we're called via a symlink.
me =
  if File.symlink? __FILE__
    File.readlink __FILE__
  else
    __FILE__
  end

$LOAD_PATH.unshift(File.expand_path("../../lib", me))
require "rubyku"

class App < Thor

  desc "init HOSTNAME", "Initialize the target server"
  def init(hostname)
    Rubyku::SystemInitializer.new(hostname, options).run
  end

  desc "add",
    "Add the local Ruby project to the remote host"
  method_option :local_path, type: :string,
    desc: "The local path to the git project to add. " +
          "If this option is not specified, the current working directory will be used."
  method_option :git_remote_name, type: :string,
    desc: "The name of the git remote to add to the local repository. " +
          "If this option is not specified, the hostname will be used."
  method_option :remote_project_name, type: :string,
    desc: "The name to use on the remote server for this project. " +
          "If this option is not specified, the hostname will be used with dots replaced by dashes."
  method_option :yes, type: :boolean,
    desc: "Skip confirmation of details"
  method_option :env, type: :hash,
    desc: "List of environment variables to add, e.g. --env=AWS_ACCESS_KEY_ID:ABC123 AWS_SECRET_ACCESS_KEY:FOOBAR999"
  def add(hostname)
    Rubyku::ProjectInitializer.new(hostname, options).run
  end

end

App.start
